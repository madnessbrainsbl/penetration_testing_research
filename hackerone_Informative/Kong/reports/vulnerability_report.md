# Kong Gateway Security Vulnerability Report

**–î–∞—Ç–∞:** 25 –Ω–æ—è–±—Ä—è 2025  
**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** https://github.com/Kong/kong  
**–í–µ—Ä—Å–∏—è:** latest (master branch)

---

## –ù–∞–π–¥–µ–Ω–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏

---

### 1. üî¥ Command Injection –≤ `kong/cmd/hybrid.lua` (HIGH)

**–§–∞–π–ª:** `kong/kong/cmd/hybrid.lua` (—Å—Ç—Ä–æ–∫–∏ 51-52)

**–£—è–∑–≤–∏–º—ã–π –∫–æ–¥:**
```lua
assert(os.execute("chmod 644 " .. cert_file))
assert(os.execute("chmod 600 " .. key_file))
```

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ö–æ–º–∞–Ω–¥–∞ `os.execute()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞ –±–µ–∑ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `cert_file` –∏ `key_file` –±–µ—Ä—É—Ç—Å—è –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ CLI (`args[1]` –∏ `args[2]`).

**–í–µ–∫—Ç–æ—Ä –∞—Ç–∞–∫–∏:**
```bash
kong hybrid gen_cert "; id #" key.pem
# –∏–ª–∏
kong hybrid gen_cert "$(whoami)" key.pem
```

**Impact:** Remote Code Execution –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å –ø—Ä–∞–≤–∞–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ Kong  
**CVSS:** 7.2 (High)  
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ngx.pipe` –∏–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥ —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.

---

### 2. üî¥ SSL Verification Disabled - MITM (HIGH)

**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã:**

| –§–∞–π–ª | –°—Ç—Ä–æ–∫–∞ | –ö–æ–¥ |
|------|--------|-----|
| `kong/plugins/http-log/handler.lua` | 132 | `ssl_verify = false` |
| `kong/plugins/aws-lambda/handler.lua` | 116 | `ssl_verify = false` |
| `kong/plugins/aws-lambda/handler.lua` | 131 | `ssl_verify = false` |
| `kong/plugins/aws-lambda/handler.lua` | 158 | `ssl_verify = false` |

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
SSL-–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–µ—Ä–∞–º. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞—Ç–∞–∫–æ–≤–∞—Ç—å Man-in-the-Middle.

**–ü—Ä–∏–º–µ—Ä —É—è–∑–≤–∏–º–æ–≥–æ –∫–æ–¥–∞ (http-log):**
```lua
local res, err = httpc:request_uri(log_server_url, {
  method = method,
  headers = headers,
  body = payload,
  keepalive_timeout = keepalive,
  ssl_verify = false,  -- <-- –£–Ø–ó–í–ò–ú–û–°–¢–¨
})
```

**Impact:**  
- –ü–µ—Ä–µ—Ö–≤–∞—Ç –ª–æ–≥–æ–≤, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö http-log –ø–ª–∞–≥–∏–Ω–æ–º
- –ü–µ—Ä–µ—Ö–≤–∞—Ç –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å AWS Lambda
- –ü–æ–¥–º–µ–Ω–∞ –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

**CVSS:** 7.4 (High)  
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `ssl_verify = true` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è (—Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º).

---

### 3. üü† Sandbox Escape —á–µ—Ä–µ–∑ ngx global (MEDIUM)

**–§–∞–π–ª:** `kong/kong/tools/sandbox/init.lua` (—Å—Ç—Ä–æ–∫–∏ 171-177)

**–£—è–∑–≤–∏–º—ã–π –∫–æ–¥:**
```lua
-- allow full non-sandboxed access to everything in ngx global (including timers, :-()
ngx = ngx,
```

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
Sandbox –¥–ª—è untrusted Lua –∫–æ–¥–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ pre-function/post-function –ø–ª–∞–≥–∏–Ω–∞—Ö –∏ custom_fields_by_lua) –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ `ngx` –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, –≤–∫–ª—é—á–∞—è:
- `ngx.timer.at()` / `ngx.timer.every()` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–π–º–µ—Ä–æ–≤
- `ngx.socket.tcp()` - —Å–µ—Ç–µ–≤—ã–µ —Å–æ–∫–µ—Ç—ã
- `ngx.req.*` - –¥–æ—Å—Ç—É–ø –∫ –∑–∞–ø—Ä–æ—Å–∞–º
- `ngx.shared.*` - –æ–±—â–∞—è –ø–∞–º—è—Ç—å

**Impact:**  
–ï—Å–ª–∏ –∞—Ç–∞–∫—É—é—â–∏–π –º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å pre-function –ø–ª–∞–≥–∏–Ω (—á–µ—Ä–µ–∑ Admin API –∏–ª–∏ compromised config), –æ–Ω –º–æ–∂–µ—Ç:
1. –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ backdoor-—Ç–∞–π–º–µ—Ä—ã
2. –û—Ç–∫—Ä—ã—Ç—å —Å–µ—Ç–µ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
3. –≠–∫—Å—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ

**CVSS:** 6.5 (Medium)  
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –æ–ø–∞—Å–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º `ngx.*`

---

### 4. üü† –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π SSRF –≤ AI-–ø–ª–∞–≥–∏–Ω–∞—Ö (MEDIUM)

**–§–∞–π–ª—ã:**
- `kong/kong/llm/drivers/shared.lua`
- `kong/kong/plugins/ai-proxy/`

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
AI-–ø–ª–∞–≥–∏–Ω—ã –ø–æ–∑–≤–æ–ª—è—é—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å upstream URL –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤. –ï—Å–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–µ—Ä—ë—Ç—Å—è –∏–∑ –Ω–µ–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞, –≤–æ–∑–º–æ–∂–µ–Ω SSRF.

**–ü—Ä–∏–º–µ—Ä (shared.lua —Å—Ç—Ä–æ–∫–∞ 98-104):**
```lua
_M.upstream_url_format = {
  openai        = "...",
  azure         = fmt("%s://%%s.openai.azure.com:%s/..."),
  gemini_vertex = "https://%s",
  bedrock       = "https://bedrock-runtime.%s.amazonaws.com",
  huggingface   = "https://api-inference.huggingface.co/models/%s",
}
```

**Impact:** –î–æ—Å—Ç—É–ø –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º —Å–µ—Ä–≤–∏—Å–∞–º —á–µ—Ä–µ–∑ Kong  
**CVSS:** 5.4 (Medium)  
**–¢—Ä–µ–±—É–µ—Ç—Å—è:** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏

---

### 5. üü† Weak Default –≤ CORS Plugin (MEDIUM)

**–§–∞–π–ª:** `kong/kong/plugins/cors/handler.lua` (—Å—Ç—Ä–æ–∫–∏ 73-75)

**–ö–æ–¥:**
```lua
if n_origins == 0 or (n_origins == 1 and conf.origins[1] == "*") then
  set_header("Access-Control-Allow-Origin", "*")
  return true
end
```

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü—Ä–∏ –ø—É—Å—Ç–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `origins` –ø–ª–∞–≥–∏–Ω —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `Access-Control-Allow-Origin: *`, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–ø—Ä–µ–¥–Ω–∞–º–µ—Ä–µ–Ω–Ω–æ–º—É –æ—Ç–∫—Ä—ã—Ç–∏—é API –¥–ª—è –∫—Ä–æ—Å—Å-–¥–æ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

**Impact:** Information Disclosure —á–µ—Ä–µ–∑ CORS misconfiguration  
**CVSS:** 5.3 (Medium)

---

### 6. üü° Information Disclosure –≤ Error Messages (LOW-MEDIUM)

**–†–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã –ø–ª–∞–≥–∏–Ω–æ–≤**

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ù–µ–∫–æ—Ç–æ—Ä—ã–µ error messages –≤–∫–ª—é—á–∞—é—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ:
- –ò–º–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –ü—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º
- –í–µ—Ä—Å–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**–ü—Ä–∏–º–µ—Ä (oauth2/access.lua —Å—Ç—Ä–æ–∫–∞ 235):**
```lua
error_description = "\"" .. v .. "\" is an invalid " .. SCOPE
```

**Impact:** –ü–æ–º–æ—â—å –∞—Ç–∞–∫—É—é—â–µ–º—É –≤ —Ä–∞–∑–≤–µ–¥–∫–µ  
**CVSS:** 3.7 (Low)

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é

| # | –£—è–∑–≤–∏–º–æ—Å—Ç—å | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|---|------------|-----------|--------------|
| 1 | Command Injection | **CRITICAL** | –ó–∞–º–µ–Ω–∏—Ç—å `os.execute()` –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—É—é –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É |
| 2 | SSL Verify Disabled | **HIGH** | –í–∫–ª—é—á–∏—Ç—å SSL verification –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| 3 | Sandbox Escape | **MEDIUM** | –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å `ngx.*` –≤ sandbox |
| 4 | SSRF | **MEDIUM** | –í–∞–ª–∏–¥–∞—Ü–∏—è URLs –≤ AI –ø–ª–∞–≥–∏–Ω–∞—Ö |
| 5 | CORS Default | **MEDIUM** | –ù–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å `*` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| 7 | File Write (file-log) | **HIGH** | –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å `..` –∏ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏ |

---

### 7. üî¥ Arbitrary File Write via file-log Plugin (HIGH)

**–§–∞–π–ª:** `kong/kong/plugins/file-log/schema.lua` + `handler.lua`

**–£—è–∑–≤–∏–º—ã–π –∫–æ–¥ (schema.lua —Å—Ç—Ä–æ–∫–∞ 13):**
```lua
match = [[^[^%s*&%%\`][^*&%%\`]*[^%s*&%%\`]$]],
```

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—É—Ç–∏ –≤ file-log –ø–ª–∞–≥–∏–Ω–µ –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç:
- `..` (path traversal)
- `/` (–∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏)

–ê—Ç–∞–∫—É—é—â–∏–π —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ Admin API –º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å file-log –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã.

**PoC:**
```bash
curl -X POST http://localhost:8001/services/test/plugins \
  --data "name=file-log" \
  --data "config.path=/etc/cron.d/backdoor"
```

–ò–ª–∏ —Å path traversal:
```bash
--data "config.path=../../../tmp/evil.log"
```

**Impact:**
- –ó–∞–ø–∏—Å—å –≤ cron –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ ‚Üí RCE
- –ü–µ—Ä–µ–∑–∞–ø–∏—Å—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- DoS —á–µ—Ä–µ–∑ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∏—Å–∫–∞

**CVSS:** 7.5 (High)  
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å whitelist —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å `..` –∏ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏.

---

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

### –ß—Ç–æ –ù–ï —è–≤–ª—è–µ—Ç—Å—è —É—è–∑–≤–∏–º–æ—Å—Ç—å—é:
1. **JWT Plugin** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–ø–∏—Å–∏, "none" algorithm –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
2. **pre-function loadstring** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç sandbox (—Ö–æ—Ç—è –∏ —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏)
3. **Template rendering** - ai-prompt-template –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π gsub —Å —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–µ–π

### –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ:
- Kong Konnect (cloud.konghq.com) - –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
- Kong Mesh - —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
- GitHub Actions workflows - –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã CI/CD

---

## –î–ª—è –ø–æ–¥–∞—á–∏ –Ω–∞ HackerOne

**–ù–∞–∏–±–æ–ª–µ–µ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω—ã–µ –¥–ª—è bounty:**

1. **Command Injection (HIGH)** - —á—ë—Ç–∫–∏–π PoC, –ª–µ–≥–∫–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏
2. **Arbitrary File Write (HIGH)** - path traversal –≤ file-log –ø–ª–∞–≥–∏–Ω–µ
3. **SSL Verify Disabled (HIGH)** - –≤–ª–∏—è–µ—Ç –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤ production

**–§–æ—Ä–º–∞—Ç –æ—Ç—á—ë—Ç–∞:**
```
## Summary
[Brief description]

## Steps to Reproduce
1. ...
2. ...

## Impact
[What can attacker achieve]

## Suggested Fix
[How to fix]
```
