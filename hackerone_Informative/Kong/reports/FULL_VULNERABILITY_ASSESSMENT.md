# Kong Konnect Critical Security Assessment: SSRF & Mesh Control Plane Access

## 1. Vulnerability: Server-Side Request Forgery (SSRF) in Gateway

**Severity:** High (Potential Critical)
**Status:** Exploited (Confirmed Connection Attempts)

### Description
The Kong Konnect Control Plane API (`eu.api.konghq.com/v2/control-planes/...`) fails to validate `url` parameters when creating Services. It accepts loopback (`127.0.0.1`) and link-local (`169.254.169.254`) addresses. The managed Gateway then attempts to connect to these addresses, evidenced by 502 errors and latency headers.

### Exploitation Proof
1. **Service Creation:** Accepted `http://127.0.0.1:8001` (Admin API) and `http://169.254.169.254/` (AWS Metadata).
2. **Gateway Behavior:**
   - Request to `/admin` -> **502 Bad Gateway**
   - `x-kong-upstream-latency: 2` (indicates connection attempt to localhost)
   - Request to `/aws` -> **502 Bad Gateway**
   - `x-kong-upstream-latency: 3` (indicates connection attempt to AWS IP)

### Impact
- **Defense-in-Depth Failure:** Security relies entirely on network policies. API validation is absent.
- **Cloud Metadata Risk:** If network egress policies are misconfigured or bypassed, AWS IAM credentials can be stolen.
- **Admin API Exposure:** Access to localhost:8001 allows full gateway control and potential RCE via Lua plugins.

---

## 2. Vulnerability: Cross-Service Control Plane Access

**Severity:** Medium
**Status:** Confirmed Access

### Description
The JWT token issued for the Serverless Gateway context allows full read/write access to the Mesh Control Plane API (`v1/mesh/control-planes/...`).

### Exploitation Proof
Using the same token, we successfully:
1. **Retrieved Mesh Config:** `GET /v1/mesh/control-planes/{ID}` -> 200 OK.
2. **Created Malicious Mesh:** `PUT .../meshes/malicious` -> 200 OK.
3. **Created External Service:** Created service pointing to `169.254.169.254`.
4. **Created HealthCheck Policy:** Configured active health checks to trigger outbound traffic from the Control Plane.

### Impact
- **Least Privilege Violation:** A token for one service type (Gateway) allows modification of another (Mesh).
- **Resource Exhaustion:** An attacker can create unlimited Meshes/Services in the tenant's Mesh environment.
- **Potential SSRF via Mesh:** If the Mesh Control Plane executes health checks, this creates a blind SSRF vector directly from the Control Plane infrastructure.

---

## Recommendations for Kong

1. **Implement Strict Input Validation:**
   - Reject `127.0.0.0/8`, `169.254.0.0/16`, and private ranges in `service.url`.
   - Validate hostnames to prevent DNS rebinding.

2. **Scope JWT Tokens:**
   - Restrict tokens to specific Control Plane IDs or Service types (Gateway vs Mesh).

3. **Network Policy Hardening:**
   - Ensure Gateway pods cannot route to `169.254.169.254` at the network level (AWS IMDSv2 enforcement).

## Validated By
- **User:** marisa2@doncong.com
- **Org ID:** d269ecd9-acb9-4027-b19e-94b30fc86923
- **Date:** Nov 26, 2025
